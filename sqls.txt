DROP DATABASE IF EXISTS BRYNHILDR;
CREATE DATABASE BRYNHILDR;
USE BRYNHILDR;
DROP TABLE IF EXISTS PAYMENTS;
DROP TABLE IF EXISTS OIL_TRANSACTIONS;
DROP TABLE IF EXISTS CLIENTS_TRANS;
DROP TABLE IF EXISTS CLIENTS;
DROP TABLE IF EXISTS TRADERS;
DROP TABLE IF EXISTS USERS;
CREATE TABLE USERS(
        UID INTEGER AUTO_INCREMENT,
        EMAIL VARCHAR(100),
        PASSWORD CHAR(32),
        TYPE INTEGER NOT NULL,
        PRIMARY KEY (UID),
        UNIQUE (EMAIL)
        );
CREATE TABLE CLIENTS(
        UID INTEGER,
        FIRST_NAME VARCHAR(100),
        LAST_NAME VARCHAR(100),
        PHONE_NUM CHAR(11),
        CELLPH_NUM CHAR(11),
        STATE VARCHAR(20),
        CITY VARCHAR(30),
        STREET VARCHAR(50),
        ZIP_CODE CHAR(5),
        LEVEL INTEGER,
        CASH_BALAN INTEGER,
        OIL_BALAN INTEGER,
        UNIQUE (PHONE_NUM),
        UNIQUE (CELLPH_NUM),
        PRIMARY KEY (UID),
        FOREIGN KEY (UID) REFERENCES USERS(UID)
        );
CREATE TABLE TRADERS(
        UID INTEGER,
        TRADER_NAME INTEGER,
        PRIMARY KEY (UID),
        FOREIGN KEY (UID) REFERENCES USERS(UID)
        );
CREATE TABLE CLIENTS_TRANS(
        T_ID INTEGER AUTO_INCREMENT,
        T_DATE DATE NOT NULL,
        C_ID INTEGER NOT NULL,
        TR_ID INTEGER,
        PRIMARY KEY (T_ID),
        FOREIGN KEY (C_ID) REFERENCES CLIENTS(UID),
        FOREIGN KEY (TR_ID) REFERENCES TRADERS(UID)
        );
CREATE TABLE OIL_TRANSACTIONS(
        T_ID INTEGER NOT NULL,
        COMM_OIL INTEGER DEFAULT 0,
        COMM_CASH INTEGER DEFAULT 0,
        OIL_BALAN INTEGER NOT NULL,
        CASH_BALAN INTEGER NOT NULL,
        PRIMARY KEY (T_ID),
        FOREIGN KEY (T_ID) REFERENCES CLIENTS_TRANS(T_ID)
        ON DELETE CASCADE
        );
CREATE TABLE PAYMENTS(
        T_ID INTEGER NOT NULL,
        AMOUNT_PAY INTEGER NOT NULL,
        CASH_BALAN VARCHAR(255),
        OIL_BALAN VARCHAR(255),
        PRIMARY KEY (T_ID),
        FOREIGN KEY (T_ID) REFERENCES CLIENTS_TRANS(T_ID)
        ON DELETE CASCADE
        );
